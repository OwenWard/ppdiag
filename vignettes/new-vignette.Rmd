---
title: 'ppdiag: a diagnostic tool for temporal data'
tags:
- R
- point processes
- event times
date: "`r Sys.Date()`"
output:
  pdf_document: 
    citation_package: biblatex
  rticles::joss_article: default
  html_document:
    df_print: paged
    citation_package: biblatex
authors:
- name: author names
  affiliation: 1
affiliations:
  name: Columbia University
  index: 1
bibliography: paper.bib
journal: JOSS
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.height = 4
)
set.seed(100) # to make it reproducible
```
# Summary
This package provides functions to evaluate the fit of univariate temporal point processes. 

Existing functions aim at: 

- Simulating data from a range of common univariate point processes including Homogeneous Poisson Process, Hawkes Process, and Markov-modulated Hawkes Process.

- Fitting a range of univariate point processes to data.

- After fitting a point process to some data, evaluating the ability of that 
point process to capture the temporal structure present in this data.

# Applying the functions on the Brastings dataset
For demonstration of how this package would help users with diagnostics of models, we apply our functions to the following Brastings dataset from the SAPP package: 
```{r setup}
library(ppdiag)
library(SAPP)
data(Brastings)
Brastings <- Brastings[1:300]
```

## Fitting HPP to the Brastings data
```{r}
hpp_fit <- fithpp(Brastings)
```
## Plotting intensity of the fitted HPP
```{r}
drawHPPIntensity(hpp_fit, Brastings, plot_events=TRUE)
```

## Diagnosing the fitted HPP
```{r}
diagpp(hpp_fit, Brastings)
```

## Fitting HP to the Brastings data
```{r}
hp_fit <- fithp(events=Brastings)
```

## Plotting intensity of the fitted HP
```{r}
first_15 <- Brastings[1:15]
hp_15 <- fithp(events=first_15)
drawHPIntensity(hp_15, events=first_15, plot_events=TRUE,
                int_title="HP Intensity for the first 15 Brastings events")
```

## Diagnosing the fitted HP
```{r}
diagpp(hp_fit, Brastings)
```

In the network setting, Pearson residual is more appropriate in measuring the models than raw residuals.[@Jing2020] The diagnostics of the HPP model shows pearson residual=-13.96, and the diagnostics of the HP model shows pearson residual=13.15. Both models seem to produce similar absolute residuals. We then look at the k-s statistics, for HPP, the D-statistic is 0.152 with p-value=1.85e-06; for HP, the D-statistic is 0.0461 with p-value=0.547. This indicates that HP is a better fit of the intensity with the D-statistic closer to 0 and a p-value closer to 1. So diagpp helps us to understand that Brastings data is better fitted to the Hawkes model in comparison with the Homogeneous Poisson model. 

# Applying the functions on the email dataset
```{r, message=FALSE}
library(openintro)
library(lubridate)
first <- ymd_hms(email$time[1],tz="EST")
second <- ymd_hms(email$time[2],tz="EST")
time <- (as.duration(interval(first,
                            ymd_hms(email$time[-1],tz="EST")))/3600)[1:300]
time <- sort(unique(time))
# to remove identical times
```
## Fitting HPP to the email data
```{r}
hpp_fit <- fithpp(time)
```
## Plotting intensity of the fitted HPP
```{r}
drawHPPIntensity(hpp_fit, time, plot_events=TRUE)
```
## Diagnosing the fitted HPP
```{r}
diagpp(hpp_fit, time)
```
## Fitting HP to the email data
```{r}
hp_fit = fithp(events=time)
```
## Plotting intensity of the fitted HP
```{r}
drawHPIntensity(hp_fit, events=time, plot_events=TRUE)
```
## Diagnosing the fitted HP
```{r}
diagpp(hp_fit, time)
```

# References