---
title: "PPDiag"
output: pdf_document
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
devtools::load_all()  ## loads ppdiag
```

# Homogeneous Poisson Process

## Class
hpp(lambda, start=0, end=1, n = NULL) takes lambda(rate of the poisson process), start and end(start and end time of events), n(number of events) as inputs and returns an object of class hpp, in the form of a list of parameters provided. 
```{r}
pois_y <- hpp(lambda = 1, end = 10)

pois_y
```


## Simulate
```{r}
# events <- simulatehpp(lambda = 1, end = 10)
# events

pois_y$n <- 50
events <- simulatehpp(pois_y)
events


```



```{r}
# sample simulation of 10 hpp events
s1=simulatehpp(hpp(lambda=1,n=10))
temp=s1
inter_s1=s1[2:length(s1)]-temp[1:length(temp)-1]
hist(inter_s1,main="interevent times")


# sample simulation of 50 hpp events
s2=simulatehpp(hpp(lambda=3,n=50))
temp=s2
inter_s2=s2[2:length(s2)]-temp[1:length(temp)-1]
hist(inter_s2,main="interevent times")

# sample simulation of 100 hpp events
s3=simulatehpp(hpp(lambda=1,n=100))
temp=s3
inter_s3=s3[2:length(s3)]-temp[1:length(temp)-1]
hist(inter_s3,main="interevent times")
```

## Fit
```{r}

fithpp(events)

fit_hpp <- fithpp(events)

```

## Plot
```{r}
plothpp_step(events)
```


```{r}
drawHPPIntensity(pois_y,color = "red")

# this plots the fit_hpp intensity and its corresponding simulated events, since plot_events default is FALSE:
drawHPPIntensity(fit_hpp,events=events, color = "red")

# this plots the inputted events, since plot_events=TRUE:
drawHPPIntensity(fit_hpp, events=events, color = "red", plot_events=TRUE)
```

## Diagnostics
```{r}
diagpp(pois_y,t=events)
```

This gives the right warning message, but we don't want to simulate data for
these plots.

```{r}
intensityqqplot(fit_hpp,fit_hpp$start,fit_hpp$end,history=0,events=events)
```

## interevent times
```{r}
temp=events
inter_hpp=events[2:length(events)]-temp[1:length(temp)-1]
hist(inter_hpp)
```

# Hawkes Process

## Class
hp(lambda0, alpha, beta, events = NULL) takes lambda0(base intensity of hawkes process), alpha(jump size of increase in intensity), beta(exponential decay of intensity), events(the first event is at time zero, events data can be added later after simulation) as inputs and returns an object of class hp, in the form of a list of parameters provided.
```{r}
hp_obj <- hp(lambda0 = 0.1,alpha = 0.45,beta = 0.5)
```

## Simulate
```{r}
# simulatehp(lambda0 = 0.1, alpha = 0.5, beta = 0.5, start = 0, end = 10,
#           history = 0)

sims <- simulatehp(hp_obj,start = 0, end = 100, history = 0)
sims

```

## Fit
```{r}
init=rep(0.1,3)

fithp(init,sims$t,max(sims$t))

fit_hp <- fithp(init,sims$t,max(sims$t))
```

## Plot

One difficulty with this is that now we cannot look at the fits for different
parameter values....

```{r}
# changing this to use hawkes event times

drawHPIntensity(hp_obj, start=0, end=max(sims$t), history=0, events = sims$t,
                plot_events = FALSE)

drawHPIntensity(fit_hp, start=0, end=max(sims$t), 
                history=0, events = sims$t, plot_events = TRUE)

```

## Diagnostics
```{r}
diagpp(hp_obj, t=sims$t)
# this is the truth


diagpp(fit_hp, t = sims$t)

```


```{r}
intensityqqplot(fit_hp,start=0,end=max(sims$t),history=0,events=events)
```

## interevent times
```{r}
temp=sims$t
inter_hp=sims$t[2:length(sims$t)]-temp[1:length(temp)-1]
hist(inter_hp)
```

# MMHP
## Class
mmhp(lambda0, lambda1, alpha, beta, Q = NULL, delta = NULL, events = NULL) takes lambda0(intensity for hpp), lambda1(base intensity for hp), alpha(jump size of the increase in intensity in hp), beta(exponential decrease of intensity in hp), Q(transition probability matrix), delta(initial state probability), events(event times, could be added later after simulation) as inputs and returns an object of class mmhp, in the form of a list of parameters provided.
```{r}
Q <- matrix(c(-0.4, 0.4, 0.2, -0.2), ncol = 2, byrow = TRUE)

x <- mmhp(Q, delta = c(1 / 3, 2 / 3), 
          lambda0 = 0.2,
          lambda1 = .75,
          alpha = 0.1,
          beta = 0.2)
```

## Simulate
```{r}
y <- simulatemmhp(x,nsim = 5)
```

## Plot
```{r}
drawUniMMHPIntensity(x, y)
```

## Diagnostics
```{r}
try(diagpp(x, t=y))
try(intensityqqplot(object=x,min(y$events),max(y$events),history=0,events=y$events,pzt=0.5))
```
