---
title: "PPDiag"
output: pdf_document
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
devtools::load_all()  ## loads ppdiag
```


# Load data
```{r}
time=readRDS("time.RDS")
```
# Homogeneous Poisson Process

## Class
### hpp(lambda, start=0, end=1, n = NULL) returns an object in class hpp
```{r}
pois_y <- hpp(lambda = 1, end = 10, n = 50)
pois_y
```


## Simulate
### simulatehpp(hpp) takes a hpp object and returns a vector of simulated events
```{r}
simulated_hpp <- simulatehpp(pois_y)
simulated_hpp
```

## Fit
### fithpp(t) takes a vector of events and returns an object of class hpp
```{r}
fit_hpp=fithpp(time)
fit_hpp
```

## Plot
### plothpp_step(events, color="red") takes a vector of events and plots its cumulated number of events
```{r}
plothpp_step(time)
```

### drawHPPIntensity(hpp, events=NULL, color = "red", plot_events=FALSE) takes a hpp object and plots the intensity, if events vector is given and plot_events is true, then we plot the given event times, otherwise we plot the event times simulated from the hpp object
```{r}
# this plots the fit_hpp intensity and its corresponding simulated events, since plot_events default is FALSE:
drawHPPIntensity(fit_hpp,events=time, color = "red")

# this plots the inputted events, since plot_events=TRUE:
drawHPPIntensity(fit_hpp, events=time, color = "red", plot_events=TRUE)
```

## Diagnostics
### diagpp(object, t, pzt = NULL) takes a hpp object and events vector and gives diagnostics including q-q plot, raw and pearson residual, k-s stats, and k-s plot.
```{r}
diagpp(fit_hpp,t=time)
```

### intensityqqplot(object,start, end, history,color=1, i=1, events, pzt = NULL) takes in a hpp object, event start and end time, history, and events vector, and plots the intensity and q-q plot
```{r}
# this plots fig.2 in the paper
intensityqqplot(fit_hpp,fit_hpp$start,fit_hpp$end,history=0,events=time,color="red")
```

# Hawkes Process

## Class
### hp(lambda0, alpha, beta, tau = NULL) returns an object in class hp
```{r}
hp_obj <- hp(lambda0 = 0.1,alpha = 0.45, beta = 0.5)
hp_obj
```

## Simulate
### simulatehp(hp, start, end, history=0) takes a hp object, and start and end time, and returns a vector of simulated events and max lambda
```{r}
simulated_hp <- simulatehp(hp_obj,start = 0, end = 100, history = 0)
simulated_hp
```

## Fit
### fithp(vec,t,termination) takes an initial vector of parameters, vector of events, and termination of the events, and returns a fitted hp object
```{r}
init=rep(0.1,3)
fit_hp <- fithp(init,time,max(time))
fit_hp
```

## Plot
### drawHPIntensity(object, start, end, history, hawkes_time, color = 1, i = 1, add=FALSE) takes a hp object, start and end time of events, history, event times vector, and plots its intensity
```{r}
drawHPIntensity(fit_hp, start=min(time), end=max(time), history=0, hawkes_time=time)
```

## Diagnostics
### diagpp(object, t, pzt = NULL) takes a hp object and events vector and gives diagnostics including q-q plot, raw and pearson residual, k-s stats, and k-s plot.
```{r}
diagpp(fit_hp, t = time)
```

### intensityqqplot(object,start, end, history,color=1, i=1, events, pzt = NULL) takes in a hp object, event start and end time, history, and events vector, and plots the intensity and q-q plot
```{r}
# fig 2 in the paper
intensityqqplot(fit_hp,start=min(time),end=max(time),history=0,events=time)
```

# MMHP
## Class
### mmhp(lambda0, lambda1, alpha, beta, Q = NULL, delta = NULL, tau = NULL) returns an object in class mmhp
```{r}
Q <- matrix(c(-0.4, 0.4, 0.2, -0.2), ncol = 2, byrow = TRUE)

mmhp_obj <- mmhp(Q, delta = c(1 / 3, 2 / 3), 
          lambda0 = 0.2,
          lambda1 = .75,
          alpha = 0.1,
          beta = 0.2)
mmhp_obj
```

## Simulate
### simulatemmhp(object, nsim = 1, given_state = FALSE, states = NULL, seed = NULL) takes a mmhp object and returns information including states of Markov Process, time of each transition, state at each event, and event times
```{r}
simulated_mmhp <- simulatemmhp(mmhp_obj,nsim = 5)
simulated_mmhp
```

## Plot
### drawUniMMHPIntensity(mmhp, simulation, yupper = 10, add = FALSE, color = 1) takes a mmhp object, and simulated mmhp, and plots the intensity
```{r}
drawUniMMHPIntensity(mmhp_obj, simulated_mmhp)
```

## Diagnostics
### diagpp gives diagnostics including q-q plot, raw and pearson residuals, k-s stats, and k-s plot. intensityqqplot provides intensity and q-q plot.
We are still working on fixing the bugs in the two functions on mmhp.
```{r}
try(diagpp(mmhp_obj, t=simulated_mmhp$tau))
try(intensityqqplot(object=mmhp_obj,min(simulated_mmhp$tau),max(simulated_mmhp$tau),history=0,events=simulated_mmhp$tau,pzt=0.5))
```
